<% current = f.object.find_or_create_a_field_by( field_setting.id, 'selection' ) %>
<%= f.simple_fields_for "selections_attributes[]", current do |ff| %>
	<% if ff.object.choices.any? %>
		<%= ff.input :choice_ids,
					label: field_setting.name.capitalize,
					hint: prepare_description_for_form_hint(field_setting),
					as: :select,
					collection: field_setting.choices.order(:label),
					label_method: :label,
					value_method: :id,
					selected: ff.object.choices.first.id,
					include_blank: field_setting.allow_null,
					input_html: { class: 'select2-item' } %>
	<% else %>
		<%= ff.input :choice_ids,
					label: field_setting.name.capitalize,
					hint: prepare_description_for_form_hint(field_setting),
					as: :select,
					collection: field_setting.choices.order(:label),
					label_method: :label,
					value_method: :id,
					selected: ( field_setting.default_choice.id unless field_setting.allow_null ),
					include_blank: field_setting.allow_null,
					input_html: { class: 'select2-item' } %>
	<% end %>
	<%= ff.input :field_setting_id, as: :hidden, input_html: { value: field_setting.id } %>
	<%= ff.input :id, as: :hidden, input_html: { value: ff.object.id } %>
	<%= ff.input :fieldable_id, as: :hidden %>
	<%= ff.input :fieldable_type, as: :hidden %>
<% end %>